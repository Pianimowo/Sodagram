<!-- Home page with all the drinks and creation dispensings -->
<!DOCTYPE html>
<html>
  <%- include('layouts/header'); -%>

  <body>
    <header class="main-header">
      <%- include('layouts/nav'); -%>
      <h1 class="band-name band-name-large">Sodagram</h1>
    </header>


    <!-- Creates the four images and buttons that is availible to the user to click and open up the dispensing menu -->
    <button class="drink-photosTOP" id="loginBtn" type="button">
      <img src="images/coke.jpg" alt="" class="dispense-buttonTOP" />
    </button>
    <button class="drink-photosTOP" id="loginBtn" type="button">
      <img src="images/unavailable.jpeg" alt="" class="dispense-buttonTOP" />
    </button>
    <button class="drink-photos" id="loginBtn" type="button">
      <img src="images/unavailable.jpeg" alt="" class="dispense-buttonTOP" />
    </button>
    <button class="drink-photos" id="loginBtn" type="button">
      <img src="images/unavailable.jpeg" alt="" class="dispense-buttonTOP" />
    </button>


    <!-- Creates the button underneath the preset drink option that opens the creative drink dispensing -->
    <div class="logout-button-div" style="margin-top: 2%; display: flex; justify-content: space-evenly; width: 100%;">
      <button
        type="button"
        class="creation-button logout-button"
        id="create-button"
        style="margin-bottom: 20%; width: 50%;"
      >
        Create
      </button>
    </div>


    <!-- Building own drink popup Menu -->
    <div id="createModal" class="modal">
      <div class="modal-content">

        <h1 class="dispense-text-modal">Build your own drink!</h1>

        <!-- Div for changing automatically with what the user chooses. Eg. If user chooses pineapple, the div color would be color yellow-->
        <div class="create-drinks">
          <div class="square-side">
            <div class="square" id="top-square">
              <p id="top-text" class="top-text"></p>
            </div>
            <div class="square" id="bottom-square">
              <p id="bottom-text" class="top-text"></p>
            </div>
          </div>


          <!-- Side with all the selection menus to choose the drinks -->
          <div class="button-side">
            <form action="/Drink" method="post" id="dispenseOwnDrink">
              <div class="top-drink">
                <label>Choose the top drink</label>

                <!-- Drink option for the top half -->
                <select
                  name="drink-opt-top"
                  id="drink-opt-top"
                  class="drink-opt-top"
                >
                  <option value="">Please choose an drink</option>
                  <option value="Coke">Coke</option>
                  <option value="MtnDew">Mountain Dew</option>
                  <option value="Fanta">Fanta</option>
                  <option value="Sprite">Sprite</option>
                </select>

                <!-- Flavor option for the top half -->
                <select
                  name="flavor-opt-top"
                  id="flavor-opt-top"
                  class="flavor-opt-top"
                >
                  <option value="">Please choose an flavor</option>
                  <option value="Peach">Peach</option>
                  <option value="Mango">Mango</option>
                  <option value="Pineapple">Pineapple</option>
                  <option value="Normal">Normal</option>
                </select>
              </div>
              <div class="bottom-drink">
                <label>Choose the bottom drink</label>
                <!-- Drink option for the bottom half -->
                <select
                  name="drink-opt-bottom"
                  id="drink-opt-bottom"
                  class="drink-opt-bottom"
                >
                  <option value="">Please choose an drink</option>
                  <option value="Coke">Coke</option>
                  <option value="MtnDew">Mountain Dew</option>
                  <option value="Fanta">Fanta</option>
                  <option value="Sprite">Sprite</option>
                </select>
                <!-- Flavor option for the bottom half -->
                <select
                  name="flavor-opt-bottom"
                  id="flavor-opt-bottom"
                  class="flavor-opt-bottom"
                >
                  <option value="">Please choose an flavor</option>
                  <option value="Peach">Peach</option>
                  <option value="Mango">Mango</option>
                  <option value="Pineapple">Pineapple</option>
                  <option value="Normal">Normal</option>
                </select>
              </div>

              <!-- Buttons which submits the form and sends the selections to the backend -->
              <button class="dispense-button" type="submit">Dispense!</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- The popup menu which enables the normal drink choosing mode -->
    <div id="loginModal" class="modal">
      <div class="modal-content">

        <h1 class="dispense-text-modal">
          Choose the flavor you want to dispense!
        </h1>

        <img
          src="images/coke.jpg"
          alt=""
          class="dispense-buttonTOP dispense_coke"
        />

        
        <div class="dispense">

          <!-- Button for choosing the peach dispensing option -->
          <form action="/Dispense1" method="post" id="dispensePeach">
            <button type="submit" class="peach_dispense">Peach</button>
          </form>

          <!-- Button for choosing the mango dispensing option -->
          <form action="/Dispense2" method="post" id="dispenseMango">
            <button type="submit" class="mango_dispense">Mango</button>
          </form>

          <!-- Button for choosing the pineapple dispensing option -->
          <form action="/Dispense3" method="post" id="dispensePineapple">
            <button type="submit" class="pineapple_dispense">Pineapple</button>
          </form>
        </div>
      </div>
    </div>


    <!-- Opens the popup menu to log one out after pressing the Profile button while logged in -->
    <div id="logoutModal" class="modal">
      <div class="modal-content modal-content-logout">
        <div class="logout-button-div">
          <button
            type="button"
            class="creation-button logout-button"
            id="logout-button"
          >
            Logout
          </button>
        </div>
      </div>
    </div>

    <%- include('layouts/footer'); -%>
  </body>

  <script>

    // Listening to the server end for outputs from the main page 
    document.addEventListener("DOMContentLoaded", function () {
      // Get the popup menus
      var loginModal = document.getElementById("loginModal");
      var createModal = document.getElementById("createModal");
      var logoutModal = document.getElementById("logoutModal");

      // Get the buttons that open the popup menus
      var loginBtn = document.getElementById("loginBtn");
      var createBtn = document.getElementById("create-button");
      var logoutBtn = document.getElementById("account");

      // Get the <span> elements that close the popup menus
      var closeButtons = document.querySelectorAll(".modal .close");

      // When the user clicks the buttons, open their selective popup menu
      loginBtn.onclick = function () {
        loginModal.style.display = "block";
      };

      createBtn.onclick = function () {
        createModal.style.display = "block";
      };

      // Add event listeners to the close button to close the popup menu
      closeButtons.forEach(function (button) {
        button.onclick = function () {
          button.closest(".modal").style.display = "none";
        };
      });

      // When the user clicks anywhere outside of the popup menu, close them
      window.onclick = function (event) {
        if (event.target == loginModal) {
          loginModal.style.display = "none";
        }
        if (event.target == createModal) {
          createModal.style.display = "none";
        }
        if (event.target == logoutModal) {
          logoutModal.style.display = "none";
        }
      };


      //Listen to backend and the main page for the dispense peach form
      document
        .getElementById("dispensePeach")
        .addEventListener("submit", function (event) {

          //Prevents the res to go to the html page
          event.preventDefault();

          //Recieves the information from the backend
          fetch("/Dispense1", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({}),
          })
            .then((response) => response.json())
            .then((data) => {

              //Displays to the user that the drink is being dispensed 
              window.alert(data.text);

              //Closes the drink dispensing popup menu
              loginModal.style.display = "none";
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });


      //Listen to backend and the main page for the dispense Mango form
      document
        .getElementById("dispenseMango")
        .addEventListener("submit", function (event) {

          //Prevents the res to go to the html page
          event.preventDefault();

          //Recieves the information from the backend
          fetch("/Dispense2", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({}),
          })
            .then((response) => response.json())
            .then((data) => {

              //Displays to the user that the drink is being dispensed 
              window.alert(data.text);

              //Closes the drink dispensing popup menu
              loginModal.style.display = "none";
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });


      //Listen to backend and the main page for the dispense Pineapple form
      document
        .getElementById("dispensePineapple")
        .addEventListener("submit", function (event) {

          //Prevents the res to go to the html page
          event.preventDefault();

          //Recieves the information from the backend
          fetch("/Dispense3", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({}),
          })
            .then((response) => response.json())
            .then((data) => {

              //Displays to the user that the drink is being dispensed 
              window.alert(data.text);

              //Closes the drink dispensing popup menu
              loginModal.style.display = "none";
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });


      //Checks to see if the user is logged in with a token
      const token = localStorage.getItem("token");
      if (token) {
        //If logged in: 

        //Sets the profile image that once clicked, displays the logout button
        document.getElementById("account").addEventListener("click", () => {
          logoutModal.style.display = "block";
        });

        //Sets the create a drink button to visible and able to be clicked on
        document.getElementById("create-button").style.display = "initial";
      } else {
        //If not logged in:

        //Sets the profile image that once clicked, redirects to the login screen
        document.getElementById("account").addEventListener("click", () => {
          window.location = "/Login.HTML";
        });

        //Sets the create drink button to not visible and not be able to clicked on
        document.getElementById("create-button").style.display = "none";
      }


      //Gets the listener for logout button
      document.getElementById("logout-button").addEventListener("click", () => {
        var txt;

        //Once clicked, open a prompt menu confirming the log out
        if (confirm("Do you wish to logout?")) {
          txt = "Yes";

          //if clicked yes, remove the token and return to home
          localStorage.removeItem("token");
          window.location = "/Index.HTML";
        } else {

          //If clicked no, click off of the menu
          txt = "No";
          modal.style.display = "none";
        }
      });


      //Add a listener for each of the select menus in the create menu

      //Added one for the flavor bottom
      document
        .querySelector(".flavor-opt-bottom")
        .addEventListener("change", (event) => {

          //Listens to the selection of the select menu and matches the color of the div on the left to match the flavor
          var flavours = document.querySelector(".flavor-opt-bottom").value;
          console.log(flavours);
          if (flavours === "Peach") {
            document.getElementById("bottom-square").style.backgroundColor =
              "#ffb0f8";
          } else if (flavours === "Mango") {
            document.getElementById("bottom-square").style.backgroundColor =
              "#ffd2a2";
          } else if (flavours === "Pineapple") {
            document.getElementById("bottom-square").style.backgroundColor =
              "#f7ffb0";
          } else if (flavours === "Normal") {
            document.getElementById("bottom-square").style.backgroundColor =
              "#333";
          }
        });


      //Added one for the flavor top
      document
        .querySelector(".flavor-opt-top")
        .addEventListener("change", (event) => {

          //Listens to the selection of the select menu and matches the color of the div on the left to match the flavor
          var flavours = document.querySelector(".flavor-opt-top").value;
          console.log(flavours);
          if (flavours === "Peach") {
            document.getElementById("top-square").style.backgroundColor =
              "#ffb0f8";
          } else if (flavours === "Mango") {
            document.getElementById("top-square").style.backgroundColor =
              "#ffd2a2";
          } else if (flavours === "Pineapple") {
            document.getElementById("top-square").style.backgroundColor =
              "#f7ffb0";
          } else if (flavours === "Normal") {
            document.getElementById("top-square").style.backgroundColor =
              "#333";
          }
        });

      //Added one for the drink bottom
      document
        .querySelector(".drink-opt-bottom")
        .addEventListener("change", (event) => {

          //Listens to the selection of the select menu and matches the text of the div on the left to match the drink
          var drinks = document.querySelector(".drink-opt-bottom").value;
          console.log(drinks);
          if (drinks === "Coke") {
            document.getElementById("bottom-text").innerText = "Coke";
          } else if (drinks === "MtnDew") {
            document.getElementById("bottom-text").innerText = "Mountain Dew";
          } else if (drinks === "Fanta") {
            document.getElementById("bottom-text").innerText = "Fanta";
          } else if (drinks === "Sprite") {
            document.getElementById("bottom-text").innerText = "Sprite";
          }
        });


      //Added one for the drink top
      document
        .querySelector(".drink-opt-top")
        .addEventListener("change", (event) => {

          //Listens to the selection of the select menu and matches the text of the div on the left to match the drink
          var drinks = document.querySelector(".drink-opt-top").value;
          console.log(drinks);
          if (drinks === "Coke") {
            document.getElementById("top-text").innerText = "Coke";
          } else if (drinks === "MtnDew") {
            document.getElementById("top-text").innerText = "Mountain Dew";
          } else if (drinks === "Fanta") {
            document.getElementById("top-text").innerText = "Fanta";
          } else if (drinks === "Sprite") {
            document.getElementById("top-text").innerText = "Sprite";
          }
        });


      //Listen to backend and the main page for the drink creation form
      document
        .getElementById("dispenseOwnDrink")
        .addEventListener("submit", function (event) {

          //Prevents the res to go to the html page
          event.preventDefault();
          const topDrink = document.querySelector(".flavor-opt-top").value;
          const topFlavour = document.querySelector(".flavor-opt-top").value;
          const botDrink = document.querySelector(".drink-opt-bottom").value;
          const botFlavour = document.querySelector(".flavor-opt-bottom").value;

          //Recieves the information from the backend
          fetch("/Drink", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              topDrink,
              botDrink,
              topFlavour,
              botFlavour,
            }),
          })
            .then((response) => response.json())
            .then((data) => {

              //Displays to the user that the drink is being dispensed 
              window.alert(data.text);

              //Closes the creationg popup menu
              createModal.style.display = "none";
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });
    });
  </script>
</html>